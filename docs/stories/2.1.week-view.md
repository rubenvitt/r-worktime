# Story 2.1: Wochenansicht Implementation

## Status
**Draft**

## Story
**Als ein** angemeldeter Nutzer,  
**möchte ich** eine detaillierte Wochenansicht meiner Arbeitszeiten,  
**damit** ich meinen wöchentlichen Überstundenverlauf nachvollziehen und analysieren kann.

## Acceptance Criteria

1. Navigation zwischen Kalenderwochen implementiert (Vor/Zurück-Buttons)
2. Anzeige der aktuellen Kalenderwoche mit Jahr und Wochennummer
3. Tagesweise Auflistung der Arbeitszeiten innerhalb der Woche
4. Ist vs. Soll Vergleich pro Tag sichtbar
5. Wochensaldo prominent angezeigt (Differenz Ist - Soll für die Woche)
6. Kumulierter Gesamtsaldo bis zur gewählten Woche angezeigt
7. Farbcodierung für Über-/Minusstunden (grün/rot)
8. Responsive Design für Mobile und Desktop
9. Ladeindikator während Datenabruf
10. Leere Zustände für Wochen ohne Einträge

## Tasks / Subtasks

- [ ] **Backend API erweitern** (AC: 1,2,3,4,5,6)
  - [ ] Endpoint `/api/entries/week/:year/:week` implementieren
  - [ ] Wochendaten-Aggregation implementieren
  - [ ] Soll-Stunden-Berechnung pro Woche
  - [ ] Kumulierten Saldo bis zur Woche berechnen
  
- [ ] **Frontend-Komponente erstellen** (AC: 1,2,7,8)
  - [ ] WeekView-Komponente mit Navigation erstellen
  - [ ] Kalenderwoche-Navigation implementieren
  - [ ] Responsive Layout umsetzen
  
- [ ] **Datenanbindung implementieren** (AC: 3,4,5,6,9,10)
  - [ ] API-Integration mit TanStack Query
  - [ ] Ladeindikator einbauen
  - [ ] Fehlerbehandlung implementieren
  - [ ] Leere Zustände gestalten

## Dev Notes

### Story Context

**Existing System Integration:**
- Integrates with: Dashboard-Komponente (Navigation zur Wochenansicht)
- Technology: Next.js 15, React 19, TanStack Query, Tailwind CSS, TypeScript
- Follows pattern: Bestehende Component-Struktur und API-Pattern
- Touch points: 
  - Dashboard `/src/app/dashboard/page.tsx` (Navigation zur Wochenansicht)
  - Authentifizierung (geschützter Bereich)
  - TimeEntry API Services

### Technical Implementation Details

**Backend Integration:**
- Erweitere bestehende API-Struktur in `/src/app/api/`
- Nutze bestehende Datenbank-Zugriffsmuster
- Verwende ISO-Wochennummern für konsistente Wochenberechnung
- Beachte Zeitzonen-Handling bei Wochenberechnung

**Frontend Architecture:**
- Neue Route: `/dashboard/week/[year]/[week]` oder als Modal/Komponente im Dashboard
- Komponenten-Struktur:
  - `WeekView.tsx` - Hauptkomponente
  - `WeekNavigation.tsx` - Navigation zwischen Wochen
  - `DayRow.tsx` - Einzelne Tagesanzeige
  - `WeekSummary.tsx` - Wochenzusammenfassung
- State Management mit TanStack Query für Caching
- URL-Parameter für direkte Links zu bestimmten Wochen

**Existing Code Patterns:**
- API Response Format: Standardisiertes Format mit `data`, `error`, `success` Feldern
- Error Handling: Zentrale Error-Behandlung bereits implementiert
- Authentication: Middleware für geschützte Routes vorhanden
- Styling: Tailwind CSS Utility-Classes, Dark Mode Support

**Key Constraints:**
- Wochenberechnung muss mit bestehender Überstunden-Logik kompatibel sein
- Performance: Maximal 1 Sekunde Ladezeit für Wochenansicht
- Mobile-First Design Approach
- Berücksichtigung verschiedener Arbeitszeitmodelle (Teil-/Vollzeit)

### Testing Standards

**Testing Requirements:**
- Test file location: `__tests__/` Ordner neben den Komponenten
- Unit Tests für:
  - Wochenberechnung-Logik
  - API-Endpoints
  - Komponenten-Rendering
- Integration Tests für:
  - Navigation zwischen Wochen
  - Datenabruf und -anzeige
  - Fehlerbehandlung
- E2E Tests für:
  - Kompletter User-Flow von Dashboard zur Wochenansicht
  - Wochennavigation
- Testing Frameworks: Jest, React Testing Library
- Minimum Coverage: 70% für neue Code

## Change Log

| Date | Version | Description | Author |
|------|---------|------------|--------|
| 2025-01-12 | 1.0 | Initial story creation | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
*To be filled by development agent*

### Debug Log References
*To be filled during development*

### Completion Notes List
*To be filled during development*

### File List
*To be filled during development*

## QA Results
*To be filled by QA agent*

---

## Definition of Done

- [ ] Functional requirements met (alle AC erfüllt)
- [ ] Integration requirements verified (Dashboard-Integration funktioniert)
- [ ] Existing functionality regression tested (Dashboard weiterhin funktionsfähig)
- [ ] Code follows existing patterns and standards
- [ ] Tests pass (existing and new) mit mindestens 70% Coverage
- [ ] Documentation updated if applicable
- [ ] Code Review durchgeführt
- [ ] Performance-Kriterien erfüllt (< 1s Ladezeit)

## Risk and Compatibility Check

**Minimal Risk Assessment:**
- **Primary Risk:** Falsche Wochenberechnung bei Jahreswechsel oder unterschiedlichen Kalendersystemen
- **Mitigation:** Umfassende Tests für Edge-Cases (Jahreswechsel, Schaltjahre, verschiedene Locale-Settings)
- **Rollback:** Feature-Flag für schrittweises Rollout

**Compatibility Verification:**
- [x] No breaking changes to existing APIs
- [x] Database changes (if any) are additive only
- [x] UI changes follow existing design patterns
- [x] Performance impact is negligible

## Implementation Priority
**High** - Dies ist ein Essential Feature aus Phase 2 und direkter nächster Schritt nach dem MVP.